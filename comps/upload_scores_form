<%doc> This is a -*- mason -*- template.
Offer a form for score upload
</%doc>

<h3 class="topic">Pontszámok feltöltése</h3>

<DIV class="error" align="center">
FIGYELEM!</p>
A pontszámok feltöltése visszavonhatatlanul módosítja a pontszámadatbázist!<br>
Feltöltés előtt készíts biztonsági másolatot az
<& link, text => "Archiválás", href => "action_show_page",
    params => { page => "db_archive_form" } &>
menüpont segítségével!
</DIV>

A feltöltendő állomány formátuma a következő:
<ul>
<li>minden sor egy hallgatónak felel meg;
<li>a sorok szerkezete a következő:
<pre>
NEPTUN:P1:P2:P3:...:group=GROUP,corr=CORR
</pre>
ahol NEPTUN a neptunkód, P1, P2, P3, stb. a feladatokra adott pontszámok, GROUP
a javított csoport, CORR pedig a javító monogramja. A végén további kulcs-érték
párok is szerepelhetnek (pl. lang=LANG), ezek az adatbázisban a notes oszlopban
fognak megjelenni.
<li>tetszőleges sorban lehet megjegyzés, % jelet követően a sor végéig;
<li>az üres sorok nem számítanak.
</ul>

<& form, action => "action_upload_scores", enctype => "multipart/form-data" &>
<TABLE>
<TR><TD>A pontszámok típusa:
<TD><SELECT NAME=type size=1>
% foreach my $type (@types) {
<OPTION><% $type->{type} %></OPTION>
% }
</SELECT>
<TR><TD>A pontszámok állománya:
<TD><INPUT TYPE=file NAME=file SIZE=60>
<TR><TD colspan=2><INPUT TYPE=submit NAME=submit VALUE="Feltölt">
</TABLE>
</FORM>

<%once>;
my ($sth, @types);
</%once>

<%init>;
if (!defined $sth) {
    $sth = $dbh->prepare("SELECT DISTINCT LEFT(id, CHAR_LENGTH(id) - 1) AS type
                          FROM scores_meta
                          WHERE formula IS NULL AND id LIKE '%1'");
}

$sth->execute;
@types = @{$sth->fetchall_arrayref({})};
$sth->finish;
</%init>
