<%doc> This is a -*- mason -*- template.
Produce a listing of all exercises in category.
</%doc>
<%attr>
window_js => 1
</%attr>

<%args>
$category			# passed through 'action_show_page'
</%args>

<h3 class="topic">'<% $cat_name %>' témakör feladatai</h3>

<!-- <P align=center><B><% $cat_name %></B></P> -->

<TABLE WIDTH=100%>
<TH width="5%">ID
<TH width="10%">Séma
<TH width="10%">Szint
<TH width="*">Leírás
<TH colspan=3>
% while (defined ($ex = $sth->fetchrow_hashref)) {
% { no strict; $exdata = eval $ex->{data}; use strict; }
<& TR, \$row &>
<TD align=right><% $ex->{id} %>
<TD align=center><% $ex->{scheme} %>
<TD align=center><% $ex->{level} %>
<TD><& $ex->{scheme} . ':describe', exdata => $exdata &>
<TD width="2%" align=center>
<& link, img => "edit.png", text => "Módosít", href => "action_modify_exercise_form",
         params => { exid => $ex->{id} } &>
% if ($m->comp('/sub/check_perm', item => "delete_exercise")) {
    <TD width="2%" align=center>
      <& js_confirm, img => "delete.png", text => "Töröl", 
	question => "Biztosan törölni akarod a $ex->{id} számú feladatot?",
	action   => "action_delete_exercise",
	hidden   => { exid => $ex->{id}, origcat => $category } &>
% }
<TD width="2%" align=center>
<& link, img => "test.png", text => "Próba", href => "action_do_exercise",
         params => { exid => $ex->{id} } &>
% }
</TABLE>

<%once>
my ($get_cat_name, $sth, $ex, $cat_name, $exdata, $row);
</%once>

<%init>;
if (!defined $get_cat_name) {
    $get_cat_name = # query category name
	$dbh->prepare("SELECT name FROM categories WHERE id=?");
    $sth = # query exercise data
	$dbh->prepare("SELECT exercises.id as id, scheme, data,
                              levels.name as level FROM exercises, levels
		       WHERE category=? AND levels.id=exercises.level
                       ORDER BY level, exercises.id");
}

$get_cat_name->execute($category);
($cat_name) = $get_cat_name->fetchrow_array;
$get_cat_name->finish;

$sth->execute($category);
$row = 0;
</%init>

<%cleanup>;
$sth->finish;
</%cleanup>
