#!/bin/bash
#
# Usage:
#
# ./guts-docker shell - to run a shell in the container
# ./guts-docker <cmd> <args> - to directly run a guts command in the container
#
set -euo pipefail

# check for running container
if [[ -z $(docker compose ps -q guts) ]]; then
    echo 'Make sure the guts container is up by running the following command:'
    echo '$ docker compose up -d guts'
    exit 1
fi

# invoke shell or guts command directly
if [[ $* == shell ]]; then
    exec docker compose exec guts /bin/bash
elif [[ ${1-} == testd ]]; then
    # run testd command protected by daemons script
    exec docker compose exec -T guts ./daemons run ./guts "$@"
else
    exec docker compose exec -T guts ./guts "$@"
fi
