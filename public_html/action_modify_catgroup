<%doc> This is a -*- mason -*- template.
Modify the category group identified by the $catgroup parameter.
</%doc>

<%args>
$rank
$name
@members => () # may be undef if none is selected
</%args>

<%once>;
my $sth;
</%once>

<%init>;
if (!defined $sth) {
    $sth = # update category group
	$dbh->prepare("UPDATE catgroups SET name=?, members=?
                       WHERE rank=?");
}

if (!$m->comp('/sub/check_perm', item => "catgroup_mgmt")) {
    $data->{MSG} = "Nem vagy jogosult témacsoportok módosítására!";
    redirect("news");
} else { 
    # members must be separated by "|" in order to form a regexp
    if ($sth->execute($name, (join "|", @members), $rank) != 1) {
	$data->{MSG} = "A témacsoportot nem sikerült módosítani.";
    } else {
	$data->{MSG} = "Témacsoport módosítva.";
    }
    redirect("catgroup_mgmt");
}
</%init>
